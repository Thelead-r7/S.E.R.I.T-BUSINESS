<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Publications</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
</head>
<body>
  <h2>üì∞ Derni√®res publications</h2>
  <div id="publications-container"></div>

  <a href="index.html">
    <button style="margin-top: 20px;">üè† Retour √† l'accueil</button>
  </a>

  <script>
    
// Import the functions you need from the SDKs you need
import { initializeApp } from "firebase/app";
// TODO: Add SDKs for Firebase products that you want to use
// https://firebase.google.com/docs/web/setup#available-libraries

// Your web app's Firebase configuration
const firebaseConfig = {
  apiKey: "AIzaSyDPavrp_mfV0POiDF3V4ZOZ0SHZGwgTmGs",
  authDomain: "serit-societe.firebaseapp.com",
  projectId: "serit-societe",
  storageBucket: "serit-societe.firebasestorage.app",
  messagingSenderId: "25581120285",
  appId: "1:25581120285:web:b8ee391fabf3d626480ff4"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const container = document.getElementById('publications-container');

    function renderPublication(id, data) {
      const div = document.createElement('div');
      div.className = "publication";
      div.innerHTML = `
        <h3>${data.titre}</h3>
<img src="${data.imageURL}" alt="Publication">
<p>${data.contenu}</p>
        <small>üóìÔ∏è Publi√© le : ${new Date(data.date).toLocaleDateString()}</small><br>
        <button onclick="aimer('${id}')">üëç J‚Äôaime (<span id="like-${id}">${data.likes || 0}</span>)</button>
        
        <div style="margin-top:10px;">
          <input type="text" id="commentaire-${id}" placeholder="Ajouter un commentaire">
          <button onclick="commenter('${id}')">Commenter</button>
          <ul id="liste-commentaires-${id}"></ul>
        </div>
        <hr>
      `;
      container.appendChild(div);

      // Afficher les commentaires existants
      if (data.commentaires) {
        const liste = document.getElementById(`liste-commentaires-${id}`);
        data.commentaires.forEach(c => {
          const li = document.createElement('li');
          li.textContent = c;
          liste.appendChild(li);
        });
      }
    }

    db.collection("publications").orderBy("date", "desc").onSnapshot(snapshot => {
      container.innerHTML = "";
      snapshot.forEach(doc => {
        renderPublication(doc.id, doc.data());
      });
    });

    function aimer(id) {
      const ref = db.collection("publications").doc(id);
      ref.update({
        likes: firebase.firestore.FieldValue.increment(1)
      });
    }

    function commenter(id) {
      const input = document.getElementById(`commentaire-${id}`);
      const texte = input.value.trim();
      if (texte) {
        const ref = db.collection("publications").doc(id);
        ref.update({
          commentaires: firebase.firestore.FieldValue.arrayUnion(texte)
        });
        input.value = "";
      }
    }
  </script>
</body>
</html>
