<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Espace Client</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f2f2f2;
      margin: 0;
      padding: 0;
    }

    .header {
      background-color: #ff9900;
      color: white;
      padding: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .user-info {
      display: flex;
      align-items: center;
    }

    .user-info img {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      margin-right: 10px;
    }

    .stars {
      display: flex;
      gap: 5px;
      cursor: pointer;
      font-size: 24px;
      margin: 10px 0;
    }

    .stars span {
      color: #ccc;
    }

    .stars span.active {
      color: gold;
    }

    .blue-star {
      color: dodgerblue;
      font-size: 24px;
      display: none;
      cursor: pointer;
    }

    .comment-box {
      background: white;
      padding: 20px;
      margin: 20px;
      border-radius: 8px;
    }

    #avis-list {
      margin: 20px;
    }

    .avis {
      background: white;
      margin-bottom: 10px;
      padding: 10px;
      border-left: 4px solid #ff9900;
      border-radius: 5px;
    }

    .btn {
      background-color: #ff9900;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 5px;
      cursor: pointer;
    }

    .btn:hover {
      background-color: #e68a00;
    }
  </style>
</head>
<body>

  <div class="header">
    <div class="user-info" id="user-profile" style="display:none;">
      <img id="user-pic" src="" alt="User">
      <span id="user-name"></span>
    </div>
    <button id="logoutBtn" class="btn" style="display:none;">Se d√©connecter</button>
  </div>

  <div class="comment-box">
    <textarea id="comment" placeholder="Votre avis..." rows="4" style="width:100%;"></textarea>
    <div class="stars" id="star-container">
      <span data-value="1">‚òÖ</span>
      <span data-value="2">‚òÖ</span>
      <span data-value="3">‚òÖ</span>
      <span data-value="4">‚òÖ</span>
      <span data-value="5">‚òÖ</span>
    </div>
    <span id="blue-star" class="blue-star">üîµ</span>
    <button class="btn" onclick="envoyerAvis()">Envoyer</button>
  </div>

  <div id="avis-list"></div>

  <!-- Firebase SDKs -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, onAuthStateChanged, signInWithPopup, GoogleAuthProvider, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { getFirestore, collection, addDoc, getDocs, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    // üîß CONFIG FIREBASE ICI
  // Import the functions you need from the SDKs you need
import { initializeApp } from "firebase/app";
// TODO: Add SDKs for Firebase products that you want to use
// https://firebase.google.com/docs/web/setup#available-libraries

// Your web app's Firebase configuration
const firebaseConfig = {
  apiKey: "AIzaSyDPavrp_mfV0POiDF3V4ZOZ0SHZGwgTmGs",
  authDomain: "serit-societe.firebaseapp.com",
  projectId: "serit-societe",
  storageBucket: "serit-societe.firebasestorage.app",
  messagingSenderId: "25581120285",
  appId: "1:25581120285:web:b8ee391fabf3d626480ff4"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    let selectedRating = 0;
    let blueStar = false;

    const stars = document.querySelectorAll("#star-container span");
    const blueStarIcon = document.getElementById("blue-star");

    stars.forEach(star => {
      star.addEventListener("click", () => {
        selectedRating = parseInt(star.getAttribute("data-value"));
        updateStars();
      });
    });

    function updateStars() {
      stars.forEach(star => {
        star.classList.remove("active");
        if (parseInt(star.getAttribute("data-value")) <= selectedRating) {
          star.classList.add("active");
        }
      });
      if (selectedRating === 5) {
        blueStarIcon.style.display = "inline";
      } else {
        blueStarIcon.style.display = "none";
        blueStar = false;
      }
    }

    blueStarIcon.addEventListener("click", () => {
      blueStar = !blueStar;
      blueStarIcon.style.opacity = blueStar ? "1" : "0.3";
    });

    async function envoyerAvis() {
      const commentaire = document.getElementById("comment").value;
      const user = auth.currentUser;

      if (!user) {
        alert("Connectez-vous avec Gmail pour poster un avis.");
        return;
      }

      if (!commentaire || selectedRating === 0) {
        alert("Veuillez √©crire un commentaire et donner une note.");
        return;
      }

      try {
        await addDoc(collection(db, "avis"), {
          nom: user.displayName,
          photo: user.photoURL,
          commentaire,
          note: selectedRating,
          etoileBleue: blueStar,
          date: serverTimestamp()
        });

        document.getElementById("comment").value = "";
        selectedRating = 0;
        blueStar = false;
        updateStars();
        afficherAvis();

      } catch (e) {
        console.error("Erreur lors de l‚Äôenvoi :", e);
      }
    }

    async function afficherAvis() {
      const avisList = document.getElementById("avis-list");
      avisList.innerHTML = "";

      const querySnapshot = await getDocs(collection(db, "avis"));
      querySnapshot.forEach((doc) => {
        const data = doc.data();
        const avis = document.createElement("div");
        avis.classList.add("avis");

        avis.innerHTML = `
          <strong><img src="${data.photo}" width="20" height="20" style="border-radius:50%;"> ${data.nom}</strong><br>
          ${"‚≠ê".repeat(data.note)} ${data.etoileBleue ? "üîµ" : ""}<br>
          ${data.commentaire}
        `;
        avisList.appendChild(avis);
      });
    }

    // Auth
    onAuthStateChanged(auth, (user) => {
      if (user) {
        document.getElementById("user-profile").style.display = "flex";
        document.getElementById("user-name").textContent = user.displayName;
        document.getElementById("user-pic").src = user.photoURL;
        document.getElementById("logoutBtn").style.display = "inline-block";
        afficherAvis();
      } else {
        const provider = new GoogleAuthProvider();
        signInWithPopup(auth, provider).catch(console.error);
      }
    });

    document.getElementById("logoutBtn").addEventListener("click", () => {
      signOut(auth).then(() => location.reload());
    });
  </script>
</body>
        </html>
